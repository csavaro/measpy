 <!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>measpy (MEASurements with PYthon) &mdash; measpy  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="GNU LESSER GENERAL PUBLIC LICENSE" href="copyright.html" />
    <link rel="prev" title="Welcome to measpy’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            measpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Readme</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#usage-example">Usage example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functional-programing-paradigm">Functional programing paradigm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#units">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#releasing">Releasing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_signal_tutorial.html">Signal tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_spectral_tutorial.html">Spectral tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="measpy.html">measpy package</a></li>
</ul>

    <a href="genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">measpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">measpy (MEASurements with PYthon)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="measpy-measurements-with-python">
<h1>measpy (MEASurements with PYthon)<a class="headerlink" href="#measpy-measurements-with-python" title="Link to this heading"></a></h1>
<p><em>A package for easy data acquisition and signal processing/analysis</em></p>
<p><img alt="Documentation" src="https://github.com/odoare/measpy/workflows/docs/badge.svg" />
<img alt="Build" src="https://github.com/odoare/measpy/actions/workflows/release.yml/badge.svg" /></p>
<p>(c) 2021-2023 Olivier Doaré
Contact: olivier.doare&#64;ensta-paris.fr</p>
<p>measpy is a set of classes and methods that</p>
<ul class="simple">
<li><p>helps signal processing and analysis using rapid and compact Python scripting, thanks to the functional programming paradigm proposed by this package,</p></li>
<li><p>ease and unify the data acquisition process with various DAQ cards</p></li>
</ul>
<p>Documentation: <a class="reference external" href="https://odoare.github.io/measpy">https://odoare.github.io/measpy</a></p>
<p><strong>WARNING:</strong> <em>major incompatible changes have been made to the measurement class for v0.1, if backward compatibility is needed, the old measurement class system is kept in the pre v0.1 branch. Changes in this branch will only concern eventual bug fixing.</em></p>
<p>The base classes defined by <code class="docutils literal notranslate"><span class="pre">measpy</span></code> are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Signal</span></code>: This is the core class of the package. It defines a signal through a sampling frequency, a physical unit and a list of samples and a description. Additional properties can be defined in order to take into account calibration or time shifting of the signal with respect to a reference time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Spectral</span></code>: This class represents the signals in the Fourier space. A spectral object contains the complex amplitudes as a 1D numpy array for frequencies up to the Nyquist frequency or the sampling frequency, and some properties as sampling frequency, unit and description.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Measurement</span></code> : A class that describe a data acquisition process, its outputs (Signal objects), its inputs (Signal objects)…</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Weighting</span></code> : A weighting class holds complex values for a list of frequencies, and methods to to smoothing, interpolation, etc.</p></li>
</ul>
<p>For now, data acquisition with these daq devices are implemented :</p>
<ul class="simple">
<li><p>Audio cards, via the <code class="docutils literal notranslate"><span class="pre">sounddevice</span></code> package,</p></li>
<li><p>NI DAQ cards, via the <code class="docutils literal notranslate"><span class="pre">nidaqmx</span></code> package.</p></li>
<li><p>Picoscope scopes, via the <code class="docutils literal notranslate"><span class="pre">picosdk-python-wrappers</span></code> package.</p></li>
</ul>
<p>To import the package and perform data acquisition with sound cards:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">measpy</span> <span class="k">as</span> <span class="nn">mp</span>
</pre></div>
</div>
<p>This will import the classes <code class="docutils literal notranslate"><span class="pre">mp.Measurement</span></code>, <code class="docutils literal notranslate"><span class="pre">mp.Signal</span></code>, <code class="docutils literal notranslate"><span class="pre">mp.Spectral</span></code> and <code class="docutils literal notranslate"><span class="pre">mp.Weighting</span></code>.</p>
<p>To do data acquisition one has to select the module that corresponds to the target device. If it is a soundcard:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">measpy.audio</span> <span class="kn">import</span> <span class="n">audio_run_measurement</span>
</pre></div>
</div>
<p>If it is a NI daq card:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">measpy.ni</span> <span class="kn">import</span> <span class="n">ni_run_measurement</span>
</pre></div>
</div>
<p>If it is a Picoscope of the ps2000 series:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">measpy.ps2000</span> <span class="kn">import</span> <span class="n">ps2000_run_measurement</span>
</pre></div>
</div>
<p>If it is a Picoscope of the ps4000 series:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">measpy.ps4000</span> <span class="kn">import</span> <span class="n">ps4000_run_measurement</span>
</pre></div>
</div>
<p>In theses modules, there’s also the <code class="docutils literal notranslate"><span class="pre">audio_get_devices</span></code> and <code class="docutils literal notranslate"><span class="pre">ni_get_devices</span></code> functions to get a list of devices present in the system. To get the list of devices, do for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">measpy.audio</span> <span class="kn">import</span> <span class="n">audio_get_devices</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">audio_get_devices</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
<section id="usage-example">
<h2>Usage example<a class="headerlink" href="#usage-example" title="Link to this heading"></a></h2>
<p>Consider the following experiment in which we want to record a pressure and an acceleration while we send a white noise at the sound card output (typical sound and vibration transfer function measurement):</p>
<ul class="simple">
<li><p>a white noise between 20Hz and 20kHz is sent to output 1 of the soundcard</p></li>
<li><p>a pressure is acquired at input 1 (Unit pascals)</p></li>
<li><p>an acceleration is acquired at input 2 (unit m/s^2)</p></li>
<li><p>the sampling frequency is 44100Hz</p></li>
<li><p>the calibration of signal conditionners are : 1V/pascal, 0.1V/(m/s^2)</p></li>
<li><p>the soundcard input gain is such that for 5V at its inputs, the sample amplitude is 1.0 (input or output). This value is referred to as 0dB full scale (0dBFS). It given in the soundcard specifications or has to be calibrated using known signals.</p></li>
<li><p>the duration of the measurement is 5s</p></li>
<li><p>the soundcard name is ‘My card’, as given by measpy.audio.audio_get_devices()</p></li>
</ul>
<p>First step is to import the modules and prepare the signals. We create a five seconds noise signal for output, and two empty signals with the correct properties for the inputs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">measpy</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">from</span> <span class="nn">measpy.audio</span> <span class="kn">import</span> <span class="n">audio_run_measurement</span>
<span class="n">sout</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Signal</span><span class="o">.</span><span class="n">noise</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="mi">44100</span><span class="p">,</span> <span class="n">freq_min</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">freq_max</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span> <span class="n">dur</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">sin1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;Pressure&#39;</span><span class="p">,</span> <span class="n">dbfs</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">cal</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Pa&#39;</span> <span class="p">)</span>
<span class="n">sin2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;Acceleration&#39;</span><span class="p">,</span> <span class="n">dbfs</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">cal</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m*s**(-2)&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<p>We then setup and run the measurement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">M1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="n">out_sig</span><span class="o">=</span><span class="p">[</span><span class="n">sout</span><span class="p">],</span>
                    <span class="n">out_map</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">in_sig</span><span class="o">=</span><span class="p">[</span><span class="n">sin1</span><span class="p">,</span><span class="n">sin2</span><span class="p">],</span>
                    <span class="n">in_map</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">dur</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                    <span class="n">in_device</span><span class="o">=</span><span class="s1">&#39;My card&#39;</span><span class="p">,</span>
                    <span class="n">out_device</span><span class="o">=</span><span class="s1">&#39;My card&#39;</span><span class="p">,</span>
                    <span class="n">device_type</span><span class="o">=</span><span class="s1">&#39;audio&#39;</span><span class="p">)</span>
<span class="n">audio_run_measurement</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span>
</pre></div>
</div>
<p>The data is stored in the list of <code class="docutils literal notranslate"><span class="pre">Signal</span></code> objects <code class="docutils literal notranslate"><span class="pre">M1.in_sig</span></code>. To plot the pressure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">M1</span><span class="o">.</span><span class="n">in_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The measurement can be saved in a directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">M1</span><span class="o">.</span><span class="n">to_dir</span><span class="p">(</span><span class="s1">&#39;my_measurement&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The created directory contains the measurement parameters in a file params.csv, individual signals as pairs of csv and wav files, one pair for each signal. The csv contains the signal parameters, the wav file contains the raw data points.</p>
<p>The measurement can then be restored using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">M2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Measurement</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span><span class="s1">&#39;my_measurement&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>An example of analysis consists in computing transfer function between sent signal and acquired signals. For instance, the Welch method can be implemented using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">H</span><span class="o">=</span><span class="n">M2</span><span class="o">.</span><span class="n">in_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tfe_welch</span><span class="p">(</span><span class="n">M2</span><span class="o">.</span><span class="n">out_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>The output of <code class="docutils literal notranslate"><span class="pre">tfe_welch()</span></code> is an object of the <code class="docutils literal notranslate"><span class="pre">measpy.signal.Spectral</span></code> class. This class has also a plotting method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">H</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">Spectral</span></code> object can then be used to compute an impulse response:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">irfft</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="functional-programing-paradigm">
<h2>Functional programing paradigm<a class="headerlink" href="#functional-programing-paradigm" title="Link to this heading"></a></h2>
<p>Most signal processing methods of <code class="docutils literal notranslate"><span class="pre">Signal</span></code> and <code class="docutils literal notranslate"><span class="pre">Spectral</span></code> classes return a <code class="docutils literal notranslate"><span class="pre">Signal</span></code> or <code class="docutils literal notranslate"><span class="pre">Spectral</span></code> object. This allows to write signal processing scripts by chaining these methods. For instance the impulse response calculation above can be done in one step:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">M2</span><span class="o">.</span><span class="n">in_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tfe_welch</span><span class="p">(</span><span class="n">M2</span><span class="o">.</span><span class="n">out_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">irfft</span><span class="p">()</span>
</pre></div>
</div>
<p>We might want to remove frequencies below 20Hz and above 20kHz before computing the impulse. This can be done in the same line of code, in the functional programing way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">M2</span><span class="o">.</span><span class="n">in_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tfe_welch</span><span class="p">(</span><span class="n">M2</span><span class="o">.</span><span class="n">out_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">filter_out</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">20000</span><span class="p">])</span><span class="o">.</span><span class="n">irfft</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="units">
<h2>Units<a class="headerlink" href="#units" title="Link to this heading"></a></h2>
<p>Units are preserved during the operations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Gap</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</pre></div>
</div>
<p>should give something like pascal * second**2 / m</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading"></a></h2>
<p>Additionnal documentation and examples can be found in the ./docs and ./examples directories of the project. The main page for web documentation is <a class="reference external" href="https://odoare.github.io/measpy">https://odoare.github.io/measpy</a>.</p>
</section>
<section id="releasing">
<h2>Releasing<a class="headerlink" href="#releasing" title="Link to this heading"></a></h2>
<p>Releases are published automatically when a tag is pushed to GitHub.</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">   </span><span class="c1"># Set next version number</span>
<span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">RELEASE</span><span class="o">=</span>x.x.x

<span class="w">   </span><span class="c1"># Create tags</span>
<span class="w">   </span>git<span class="w"> </span>commit<span class="w"> </span>--allow-empty<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Release </span><span class="nv">$RELEASE</span><span class="s2">&quot;</span>
<span class="w">   </span>git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span><span class="nv">$RELEASE</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Version </span><span class="nv">$RELEASE</span><span class="s2">&quot;</span>

<span class="w">   </span><span class="c1"># Push</span>
<span class="w">   </span>git<span class="w"> </span>push<span class="w"> </span>upstream<span class="w"> </span>--tags
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to measpy’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="copyright.html" class="btn btn-neutral float-right" title="GNU LESSER GENERAL PUBLIC LICENSE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="copyright.html">Copyright</a> 2021-2023, Olivier Doaré.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>